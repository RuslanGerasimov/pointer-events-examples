<!doctype html>
<html>
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="brushstroke.js"></script>
	<link rel="stylesheet" href="global.css"/>
	<link rel="stylesheet" href="brushstroke.css"/>
    <script type="text/javascript">
        window.onload = function () {
			var elem = document.getElementById('elem');
			var centerPoint;
			var gesture;
			var gesturePointers = 0;
			var pointers = [];
			
			elem.addEventListener('pointerdown', function (event) {
				if (event.pointerType == 'touch') {
					if (!gesture) {
						gesture = new MSGesture();
						gesture.target = event.target;
					}
					gesture.addPointer(event.pointerId);
					gesturePointers++;
				}
			});
			
			elem.addEventListener('pointermove', function (event) {
				if (event.pointerType == 'touch') {
					pointers.push(event);
				}
			});
			
			elem.addEventListener('MSGestureChange', function (event) {
				if (gesturePointers > 1) {
					centerPoint = event;
				}
			});
			
			elem.addEventListener('pointerup', function () {
				if (event.pointerType == 'touch' && --gesturePointers == 0 && gesture) {
					gesture.stop();
					gesture = null;
					centerPoint = null;
				}
			});
			
			tick();
			function tick () {
				if (centerPoint) {
					createBrushstroke(centerPoint.clientX, centerPoint.clientY, '#DE3A3A');
				}
				if (pointers) {
					Array.prototype.forEach.call(pointers, function (pointer) {
						createBrushstroke(pointer.clientX, pointer.clientY, '#8FA4B5');
					});
					pointers = [];
				}
				requestAnimationFrame(tick);
			}
		};
    </script>
    <style>
		body {
			touch-action: none;
		}
	
		#elem {
			width: 100%;
			height: 100%;
			box-sizing: border-box;
            border-right: 2px solid black;
		}
    </style>
</head>
<body>
	<div id=elem></div>
    <h2 class=title>Pointer Events<br/>(MSGesture)</h2>
</body>
</html>